# Fish shell configuration
# This file uses Chezmoi templating for cross-platform support

# Platform-specific configurations
{{ if eq .chezmoi.os "darwin" }}
# macOS-specific fish configuration
set -g fish_user_paths "/opt/homebrew/bin" $fish_user_paths
set -g fish_user_paths "/opt/homebrew/sbin" $fish_user_paths

# Required to use colima + testcontainers
set -x DOCKER_HOST unix://{$HOME}/.colima/docker.sock
set -x TESTCONTAINERS_DOCKER_SOCKET_OVERRIDE /var/run/docker.sock
{{ end }}

{{ if eq .chezmoi.os "linux" }}
# Linux-specific fish configuration
set -g fish_user_paths "$HOME/.local/bin" $fish_user_paths
set -g fish_user_paths "$HOME/go/bin" $fish_user_paths

# Use Podman as Docker replacement
set -x DOCKER_HOST unix://$XDG_RUNTIME_DIR/podman/podman.sock

# Linux-specific aliases
alias open="xdg-open"
alias pbcopy="xclip -selection clipboard"
alias pbpaste="xclip -selection clipboard -o"
alias docker="podman"
{{ end }}

# Set editor
set -g EDITOR "nvim"
set -g VISUAL "nvim"

# Activate mise (version manager for Node, Python, Go, Rust, etc.)
if command -v mise &> /dev/null
    mise activate fish | source
end

# Load common functions and aliases
source ~/.config/fish/conf.d/aliases.fish

# Auto-start tmux for new Kitty windows in ~/projects
if status is-interactive
    if set -q KITTY_WINDOW_ID; and not set -q TMUX
        if command -v tmux &> /dev/null
            set -l project_dir "$HOME/Projects"
            if test -d "$project_dir"
                cd "$project_dir"
            end
            exec tmux new-session -A -s main -c "$project_dir"
        end
    end
end
